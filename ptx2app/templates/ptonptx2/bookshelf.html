{% extends 'base.html' %}

{% load staticfiles %}

{% block title %}PTX2 | Bookshelf{% endblock %}

{% block main %}
<div class="col-md-8 column">
    <div class="alert alert-warning text-center" id="jswarning">
        It looks like you have Javascript disabled. Please enable Javascript to ensure that the site works properly.
    </div>
    <script type="text/javascript">
        document.getElementById("jswarning").hidden=true;
    </script>
	{% if first_visit %}
    <div class="alert alert-info alert-dismissable text-center">
        <button type="button" class="close glyphicon glyphicon-remove" data-dismiss="alert" aria-hidden="true"></button>
        <strong>Welcome!</strong> This appears to be your first visit. You can get started by <a href="#" data-toggle="modal" data-target="#newcoursemodal" class="alert-link">adding a new course</a>.
    </div>
	{% endif %}
    {% comment %}
	{% if just_removed %}
	<div class="alert alert-info text-center">Course <i>{{dept}} {{num}} ({{r}})</i> has been removed.</div>
    {% endif %}
    {% endcomment %}
    {% for message in messages %}
    <div class="alert {% if message.tags %} alert-{{message.tags}} {% endif %} text-center">{{message}}</div>
    {% endfor %}
	<div class="row clearfix" id="needtobuy">
		<h4 padding-left="5px"> Books Needed </h4>
		{% if user.books_needed.all %}
		{% for book in user.books_needed.all %}
		<div class="col-md-3">
			<div class="thumbnail">
				<div class="caption">
					<img src={{ book.picture_link }} class="img-responsive" alt="">
					<h5><a href="/{{book.isbn}}"> {{ book.title }}</a></h5>
					<p class="course_list">
						{% for course in user.course_list.all %}
						{% for reading in course.books.all %}
						{% if reading == book %}
						Used in <i><a href="/courses/{{ course.dept }}/{{ course.num }}">{{ course.dept }} {{ course.num }}</a></i><br>
						{% endif %}
						{% endfor %}
						{% endfor %}
					</p>
					<p>
						{% include 'forms/price_widget.html' with labprice=book.labyrinth_price amazprice=book.amazon_price lowstud=book.lowest_student_price isbn=book.isbn isbn10=book.isbn10 inc_PU=True %}
					</p>
					<p>
						{% include 'forms/markasowned.html' %}
						<button class="btn btn-default" title="Mark as owned" href="#" data-toggle="modal" data-target="#markasownedmodal{{book.id}}"></button>
					</p>
				</div>
			</div>
		</div>
		{% endfor %}
		{% else %}
		<p>No books here</p>
		{% endif %}
	</div>
		<div class="row clearfix" id="selling">
			{% if user_selling.all %}
			<h4 padding-left="5px">Selling </h4>
			{% for listing in user_selling.all %}
			<div class="col-md-3">
				<div class="thumbnail">
					<div class="caption">
						<img src={{ listing.book.book.picture_link }} class="img-responsive" alt="">
						<h5><a href="/{{listing.book.book.isbn}}"> {{ listing.book.book.title }}</a></h5>
						<p>Selling for ${{ listing.price }}<br>
							{% if listing.sell_status == 'P' %}
							Offer made!<br>
							{% endif %}
						</p>
<!-- 						<p>
						<div class="btn-group">
							<form class="form-inline" id="editlistingform" method="get" name="editlistingform" action="/editlistingform/"> {% csrf_token %}
							<button type="submit" class="btn btn-default btn-sm" title="Edit listing"><span class="glyphicon glyphicon-pencil"></span></button>
							</form>
							<form class="form-inline" id="removelistingform" method="get" name="removelistingform" action="/removelistingform/"> {% csrf_token %}
							<button type="submit" class="btn btn-default btn-sm" title="Remove listing"><span class="glyphicon glyphicon-remove"></span></button>
							</form>
						</div>
						</p> -->
					</div>
				</div>
			</div>
			{% endfor %}
		</div>
		{% endif %} 
		<div class="row clearfix" id="owned">
			{% if user.books_owned.all %}

			<h4 padding-left="5px">Owned</h4>
			{% for book in user.books_owned.all %}
			<div class="col-md-3">
				<div class="thumbnail">
					<div class="caption">
						<img src="{{book.book.picture_link}}" class="img-responsive" alt="">
						<h5><a href="/{{book.book.isbn}}"> {{ book.book.title }}</a></h5>
						<p>
							Owned<br>
                            <a href="#" data-toggle="modal" data-target="#newlistingmodal{{book.pk}}">Sell?</a>
						</p>
					</div>
				</div>
            </div>
            {% include 'forms/newlisting.html' with title=book.book.title pk=book.pk bookpk=book.book.pk labprice=book.book.labyrinth_price amazprice=book.book.amazon_price lowstud=book.book.lowest_student_price isbn=book.book.isbn isbn10=book.book.isbn10 %}
		{% endfor %}
		</div>
	</div>
	{% endif %}
    {% endblock %}
